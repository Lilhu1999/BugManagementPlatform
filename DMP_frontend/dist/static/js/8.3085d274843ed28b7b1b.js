webpackJsonp([8],{"12LI":function(t,e){},"C+Qy":function(t,e){},QL95:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={components:{Upload:a("hYS1").a},data:function(){return{dialogVisible:!1,active:0,tableData:[],documentOptions:[{value:"公共文档",label:"公共文档"},{value:"项目文档",label:"项目文档"}],projectOptions:[],projectValue:"",onProject:"",document_type:""}},watch:{document_type:function(t){"公共文档"===t?this.next():this.onProject="项目文档"},projectValue:function(t){t&&this.next()}},mounted:function(){this.getTableData(),this.getProjectData()},methods:{getTableData:function(){var t=this;this.$axios.get("api/project/document/info/",{params:{pid:"-1"}}).then(function(e){var a=e.data;"000000"===a.respCode?t.tableData=a.list:t.$message.error(a.respMsg)})},getProjectData:function(){var t=this;this.$axios.get("api/project/info/").then(function(e){var a=e.data;"000000"===a.respCode?t.projectOptions=a.list:t.$message.error(a.respMsg)})},download:function(t,e){this.$axios({method:"get",url:"api/download/",params:{uid:t},responseType:"blob"}).then(function(t){var a=t.data,o=window.URL.createObjectURL(new Blob([a])),l=document.createElement("a");l.href=o,l.setAttribute("download",e),document.body.appendChild(l),l.click()}).catch(function(t){console.log(t)})},delFile:function(t){var e=this;this.$confirm("确定删除该文件吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.delete("api/project/document/del/",{params:{uid:t}}).then(function(t){var a=t.data;"000000"===a.respCode?(e.$message.success("删除成功"),e.getTableData()):e.$message.error(a.respMsg)})}).catch(function(){e.$message.info("取消删除")})},next:function(){this.active++>1&&(this.active=0)},clear:function(){var t=this;this.$nextTick(function(){t.active=0,t.value=""})},goBack:function(){window.history.back()}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("el-card",[a("div",{attrs:{slot:"header"},slot:"header"},[a("el-page-header",{attrs:{content:"文档管理"},on:{back:t.goBack}})],1),t._v(" "),a("div",[a("div",[a("el-button",{attrs:{size:"small",type:"success"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("上传文档")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"warning"}},[t._v("批量下载")])],1),t._v(" "),a("el-table",{attrs:{data:t.tableData}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{label:"文件名",prop:"fileName"}}),t._v(" "),a("el-table-column",{attrs:{label:"上传人",prop:"creator"}}),t._v(" "),a("el-table-column",{attrs:{label:"文件类型",prop:"document_type"}}),t._v(" "),a("el-table-column",{attrs:{label:"上传时间",prop:"createTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){return t.download(e.row.id,e.row.fileName)}}},[t._v("下载")]),t._v(" "),"管理员"===t.$cookies.get("user_type")?a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){return t.delFile(e.row.id)}}},[t._v("删除")]):t._e()],1)}}])})],1)],1)])],1),t._v(" "),a("div",[a("el-dialog",{attrs:{visible:t.dialogVisible,width:"40wh"},on:{close:function(e){t.dialogVisible=!1,t.getTableData(),t.clear()}}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("上传文档")]),t._v(" "),a("el-row",[a("el-col",{attrs:{span:16}},[1===t.active?a("div",[a("Upload",{attrs:{document_type:t.document_type,projectId:t.projectValue}})],1):t._e(),t._v(" "),0===t.active?a("div",[a("el-select",{attrs:{placeholder:"请选择文件类型"},model:{value:t.document_type,callback:function(e){t.document_type=e},expression:"document_type"}},t._l(t.documentOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1):t._e(),t._v(" "),0===t.active&&"项目文档"===t.onProject?a("div",{staticStyle:{"margin-top":"20px"}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:t.projectValue,callback:function(e){t.projectValue=e},expression:"projectValue"}},t._l(t.projectOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1):t._e()]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticStyle:{height:"200px"}},[a("el-steps",{attrs:{active:t.active,"finish-status":"success",direction:"vertical"}},[a("el-step",{attrs:{title:"选择文件类型"}}),t._v(" "),a("el-step",{attrs:{title:"上传文件"}})],1)],1)])],1)],1)],1)])},staticRenderFns:[]};var i=a("VU/8")(o,l,!1,function(t){a("C+Qy")},"data-v-1c464329",null);e.default=i.exports},hYS1:function(t,e,a){"use strict";var o={props:["document_type","projectId"],data:function(){return{uploadData:{pid:"",creator:"",document_type:this.document_type}}},mounted:function(){},methods:{onBeforeUpload:function(t){"项目文档"===this.document_type?this.projectId&&(this.uploadData.pid=this.projectId):this.uploadData.pid=-1,this.uploadData.creator=this.$cookies.get("username");var e=t.size/1024/1024<10;return e||this.$message.error("文件大小不能超过10MB"),e},onSuccessUpload:function(){location.reload()}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-upload",{staticClass:"upload-demo",attrs:{accept:".doc,.docx,.xls,.xlsx,.txt,.pdf,.ppt,.pptx",data:t.uploadData,drag:"","show-file-list":!1,action:"api/upload/",multiple:"",limit:1,"before-upload":t.onBeforeUpload,"on-success":t.onSuccessUpload}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传doc/docx/xls/xlsx/txt/pdf/ppt/pptx文件，且文件大小不超过10MB")])])],1)},staticRenderFns:[]};var i=a("VU/8")(o,l,!1,function(t){a("12LI")},"data-v-21fbe78f",null);e.a=i.exports}});