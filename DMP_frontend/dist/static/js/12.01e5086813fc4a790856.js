webpackJsonp([12],{Ja6d:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),s={data:function(){return{type:1,pid:"",rid:"",activeIndex:-1,dialogVisible:!1,allIterationData:[],stateButtonLoading:!1,activeIterationData:{title:"",state:"",start:"",end:""},activeRequirementData:[],formData:{title:"",state:"打开",start:"",end:""},defaultFormData:{title:"",state:"打开",start:"",end:""},formRules:{title:[{required:!0,message:"请输入迭代名称",tigger:"blur"}],start:[{required:!0,message:"请选择开始时间",tigger:"change"}],end:[{required:!0,message:"请选择结束时间",tigger:"change"}]}}},created:function(){this.pid=sessionStorage.getItem("pid")},mounted:function(){this.getIterationData()},methods:{clearForm:function(){var t=this;this.$nextTick(function(){t.$refs.formData.clearValidate()}),this.formData=r()({},this.defaultFormData)},activeCard:function(t,e){var a=this;this.activeIndex=t,this.activeIterationData=e,this.$axios.get("api/project/requirement/info/",{params:{iterationId:e.id}}).then(function(t){var e=t.data;"000000"===e.respCode?a.activeRequirementData=e.list:a.$message.error(e.respMsg)})},getIterationData:function(){var t=this;this.$axios.get("api/project/iteration/info/",{params:{pid:this.pid}}).then(function(e){var a=e.data;"000000"===a.respCode?t.allIterationData=a.list:t.$message.error(a.respMsg)})},submitForm:function(t,e){var a=this;this.$refs[t].validate(function(t){if(!t)return a.$message.error("请输入必填项"),!1;1===a.type?a.$axios.post("api/project/iteration/add/",{form:a.formData,pid:a.pid}).then(function(t){var e=t.data;"000000"===e.respCode?(a.$message.success("新增成功"),a.getIterationData()):a.$message.error(e.respMsg)}):a.$axios.post("api/project/iteration/edit/",{form:a.formData,rid:e}).then(function(t){var e=t.data;"000000"===e.respCode?(a.$message.success("修改成功"),a.getIterationData()):a.$message.error(e.respMsg)})})},handleCommand:function(t){var e=this;console.log(this.rid),"edit"===t?(this.type=2,this.dialogVisible=!0):this.$confirm("确定删除该迭代吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.delete("api/project/iteration/del/",{params:{rid:e.rid}}).then(function(t){var a=t.data;"000000"===a.respCode?(e.$message.success("删除成功"),e.getIterationData()):e.$message.error(a.respMsg)})})},changeIterationState:function(t,e){var a=this;this.stateButtonLoading=!0;var i="";i="打开"===e?"关闭":"打开",this.$axios.post("api/project/iteration/updateState/",{rid:t,state:i}).then(function(t){var e=t.data;"000000"===e.respCode?(a.$message.success("更新状态成功"),a.$nextTick,a.stateButtonLoading=!1):a.$message.error(e.respMsg)})}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"left_card",attrs:{shadow:"never"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},t._l(t.allIterationData,function(e,i){return a("el-card",{key:e.id,staticClass:"point left_in_card_style",class:{active:t.activeIndex===i},staticStyle:{"margin-bottom":"10px"},attrs:{shadow:"hover"},nativeOn:{click:function(a){return t.activeCard(i,e)}}},[a("div",[a("span",[t._v(t._s(e.title))]),t._v(" "),a("el-dropdown",{staticStyle:{float:"right"},on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-more el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"edit",icon:"el-icon-edit"},nativeOn:{click:function(a){t.rid=e.id,t.formData=e}}},[t._v("编辑")]),t._v(" "),a("el-dropdown-item",{attrs:{command:"del",icon:"el-icon-delete"},nativeOn:{click:function(a){t.rid=e.id}}},[t._v("删除")])],1)],1)],1),t._v(" "),a("div",[a("span",{staticStyle:{"font-size":"12px",color:"#999999"}},[t._v(t._s(e.start)+" ~ "+t._s(e.end))]),t._v(" "),a("el-divider")],1),t._v(" "),a("div",[a("el-progress",{attrs:{percentage:50,status:"success"}})],1)])}),1)}}])},[a("div",{attrs:{slot:"header"},slot:"header"},[a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-circle-plus-outline"},on:{click:function(e){t.dialogVisible=!0,t.type=1}}},[t._v("创建迭代")])],1)])],1),t._v(" "),a("el-col",{attrs:{span:18}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-card",{staticClass:"right_top_card",attrs:{shadow:"never"}},[t.activeIterationData.title?a("div",[a("span",{staticStyle:{color:"#999999","font-size":"18px"}},[t._v(t._s(t.activeIterationData.title))]),t._v(" "),"打开"===t.activeIterationData.state?a("el-button",{staticStyle:{"border-radius":"40px",margin:"0 20px"},attrs:{size:"mini",type:"primary",plain:"",loading:t.stateButtonLoading},on:{click:function(e){return t.changeIterationState(t.activeIterationData.id,t.activeIterationData.state)}}},[t._v("\n              打开\n            ")]):a("el-button",{staticStyle:{"border-radius":"40px",margin:"0 20px"},attrs:{size:"mini",type:"danger",plain:"",loading:t.stateButtonLoading},on:{click:function(e){return t.changeIterationState(t.activeIterationData.id,t.activeIterationData.state)}}},[t._v("\n              关闭\n            ")]),t._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#999999"}},[t._v(t._s(t.activeIterationData.start)+" ~ "+t._s(t.activeIterationData.end))])],1):t._e()])],1),t._v(" "),a("div",[a("el-card",{staticStyle:{height:"68vh"},attrs:{shadow:"never"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.activeRequirementData,"max-height":"58vh"}},[a("el-table-column",{attrs:{label:"#",type:"index",width:"80",align:"align"}}),t._v(" "),a("el-table-column",{attrs:{label:"标题",prop:"title"}}),t._v(" "),a("el-table-column",{attrs:{label:"优先级",prop:"priority"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},["紧急"===e.row.priority?a("el-tag",{attrs:{effect:"dark",type:"danger",size:"small"}},[t._v(t._s(e.row.priority))]):"高"===e.row.priority?a("el-tag",{attrs:{effect:"dark",type:"warning",size:"small"}},[t._v(t._s(e.row.priority))]):"中"===e.row.priority?a("el-tag",{attrs:{effect:"dark",type:"success",size:"small"}},[t._v(t._s(e.row.priority))]):a("el-tag",{attrs:{effect:"dark",type:"info",size:"small"}},[t._v(t._s(e.row.priority))])],1)}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"state"}}),t._v(" "),a("el-table-column",{attrs:{label:"处理人",prop:"handler"}}),t._v(" "),a("el-table-column",{attrs:{label:"预计开始",prop:"start"}}),t._v(" "),a("el-table-column",{attrs:{label:"预计结束",prop:"end"}})],1)],1)],1)])],1),t._v(" "),a("div",[a("div",[a("el-dialog",{attrs:{visible:t.dialogVisible},on:{close:function(e){t.dialogVisible=!1,t.clearForm()}}},[a("div",{attrs:{slot:"title"},slot:"title"},[1===t.type?a("span",[t._v("创建迭代")]):t._e(),t._v(" "),2===t.type?a("span",[t._v("修改迭代")]):t._e(),t._v(" "),a("el-divider")],1),t._v(" "),a("div",[a("el-form",{ref:"formData",attrs:{model:t.formData,rules:t.formRules,inline:""}},[a("el-form-item",{attrs:{label:"迭代名称",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入迭代名称",size:"small"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"迭代状态",prop:"state"}},[a("el-radio",{attrs:{label:"打开"},model:{value:t.formData.state,callback:function(e){t.$set(t.formData,"state",e)},expression:"formData.state"}},[t._v("打开")]),t._v(" "),a("el-radio",{attrs:{label:"关闭"},model:{value:t.formData.state,callback:function(e){t.$set(t.formData,"state",e)},expression:"formData.state"}},[t._v("关闭")])],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"start"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},model:{value:t.formData.start,callback:function(e){t.$set(t.formData,"start",e)},expression:"formData.start"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"end"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},model:{value:t.formData.end,callback:function(e){t.$set(t.formData,"end",e)},expression:"formData.end"}})],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[1===t.type?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.submitForm("formData"),t.dialogVisible=!1,t.clearForm()}}},[t._v("创建")]):t._e(),t._v(" "),2===t.type?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.submitForm("formData",t.rid),t.dialogVisible=!1,t.clearForm()}}},[t._v("修改")]):t._e(),t._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1,t.clearForm()}}},[t._v("取消")])],1)])],1)])],1)},staticRenderFns:[]};var n=a("VU/8")(s,o,!1,function(t){a("PeNY")},"data-v-48251eeb",null);e.default=n.exports},PeNY:function(t,e){}});