webpackJsonp([9],{"12LI":function(t,e){},LPJw:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={components:{Upload:a("hYS1").a},data:function(){return{pid:"",dialogVisible:!1,tableData:[],document_type:"项目文档",searchForm:{fileName:"",creator:""}}},mounted:function(){this.getTableData(),this.pid=sessionStorage.getItem("pid")},methods:{getTableData:function(){var t=this;this.$axios.get("api/project/document/info/",{params:{pid:sessionStorage.getItem("pid"),fileName:this.searchForm.fileName,creator:this.searchForm.creator}}).then(function(e){var a=e.data;"000000"===a.respCode?t.tableData=a.list:t.$message.error(a.respMsg)})},download:function(t,e){this.$axios({method:"get",url:"api/download/",params:{uid:t},responseType:"blob"}).then(function(t){var a=t.data,o=window.URL.createObjectURL(new Blob([a])),l=document.createElement("a");l.href=o,l.setAttribute("download",e),document.body.appendChild(l),l.click()}).catch(function(t){console.log(t)})},delFile:function(t){var e=this;this.$confirm("确定删除该文件吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.delete("api/project/document/del/",{params:{uid:t}}).then(function(t){var a=t.data;"000000"===a.respCode?(e.$message.success("删除成功"),e.getTableData()):e.$message.error(a.respMsg)})}).catch(function(){e.$message.info("取消删除")})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"文件名:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入文件名"},model:{value:t.searchForm.fileName,callback:function(e){t.$set(t.searchForm,"fileName",e)},expression:"searchForm.fileName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"上传人:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入上传人"},model:{value:t.searchForm.creator,callback:function(e){t.$set(t.searchForm,"creator",e)},expression:"searchForm.creator"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.getTableData}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"warning"}},[t._v("重置")])],1)],1)],1),t._v(" "),a("div",[a("el-card",[a("div",{attrs:{slot:"header"},slot:"header"},[a("div",[a("el-button",{attrs:{size:"small",type:"success"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("上传文档")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"warning"}},[t._v("批量下载")])],1)]),t._v(" "),a("div",[a("el-table",{attrs:{data:t.tableData}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{label:"文件名",prop:"fileName"}}),t._v(" "),a("el-table-column",{attrs:{label:"上传人",prop:"creator"}}),t._v(" "),a("el-table-column",{attrs:{label:"上传时间",prop:"createTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){return t.download(e.row.id,e.row.fileName)}}},[t._v("下载")]),t._v(" "),"管理员"===t.$cookies.get("user_type")?a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){return t.delFile(e.row.id)}}},[t._v("删除")]):t._e()],1)}}])})],1)],1)])],1),t._v(" "),a("div",[a("el-dialog",{attrs:{visible:t.dialogVisible,width:"400px"},on:{close:function(e){t.dialogVisible=!1,t.getTableData()}}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("上传项目文档")]),t._v(" "),a("div",[a("Upload",{attrs:{document_type:t.document_type,"project-id":t.pid}})],1)])],1)])},staticRenderFns:[]};var i=a("VU/8")(o,l,!1,function(t){a("hLZ0")},"data-v-077ae20a",null);e.default=i.exports},hLZ0:function(t,e){},hYS1:function(t,e,a){"use strict";var o={props:["document_type","projectId"],data:function(){return{uploadData:{pid:"",creator:"",document_type:this.document_type}}},mounted:function(){},methods:{onBeforeUpload:function(t){"项目文档"===this.document_type?this.projectId&&(this.uploadData.pid=this.projectId):this.uploadData.pid=-1,this.uploadData.creator=this.$cookies.get("username");var e=t.size/1024/1024<10;return e||this.$message.error("文件大小不能超过10MB"),e},onSuccessUpload:function(){location.reload()}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-upload",{staticClass:"upload-demo",attrs:{accept:".doc,.docx,.xls,.xlsx,.txt,.pdf,.ppt,.pptx",data:t.uploadData,drag:"","show-file-list":!1,action:"api/upload/",multiple:"",limit:1,"before-upload":t.onBeforeUpload,"on-success":t.onSuccessUpload}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传doc/docx/xls/xlsx/txt/pdf/ppt/pptx文件，且文件大小不超过10MB")])])],1)},staticRenderFns:[]};var i=a("VU/8")(o,l,!1,function(t){a("12LI")},"data-v-21fbe78f",null);e.a=i.exports}});